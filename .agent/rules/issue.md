# Issue粒度規約

Issueの適切なサイズと構造を定義するルール。

---

## 原則

- 変更行数: 50〜300行
- 変更ファイル数: 1〜5ファイル
- AC数: 2〜5個

---

## 大きすぎるサイン（分割が必要）

以下のいずれかに該当する場合は分割を検討：

- [ ] 変更行数が300行を超える見込み
- [ ] 変更ファイル数が6ファイル以上
- [ ] ACが6個以上ある
- [ ] 「〜と〜と〜をする」のように複数の動詞がある

### 分割の例

**Before（大きすぎる）:**
```
Issue: ユーザー管理機能を実装する
- ユーザー登録
- ユーザー編集
- ユーザー削除
- ユーザー一覧表示
- 権限管理
```

**After（適切なサイズ）:**
```
Issue #1: ユーザー登録APIを実装する
Issue #2: ユーザー編集APIを実装する
Issue #3: ユーザー削除APIを実装する
Issue #4: ユーザー一覧APIを実装する
Issue #5: 権限管理を実装する
```

---

## 小さすぎるサイン（統合を検討）

以下のいずれかに該当する場合は統合を検討：

- [ ] 変更行数が50行未満
- [ ] ACが1個だけ
- [ ] 他のIssueと常にセットで作業する

### 統合の例

**Before（小さすぎる）:**
```
Issue #1: Userモデルを作成する（20行）
Issue #2: Userマイグレーションを作成する（15行）
Issue #3: Userバリデーションを追加する（10行）
```

**After（適切なサイズ）:**
```
Issue #1: Userモデルとマイグレーションを作成する（45行）
  - Userモデル作成
  - マイグレーション作成
  - バリデーション追加
```

---

## 例外ラベル

原則を外れる場合は、以下のラベルを付与し**必須項目を記入**：

- `bulk-format`
  - 用途: 自動整形/リネーム
  - 必須: 理由（整形ツール名）
  - 必須: 影響/レビュー観点（機能変更がないことを確認）
  - 必須: 想定リスク（意図しない変更混入）
- `test-heavy`
  - 用途: テスト追加で行数増
  - 必須: 理由（テスト対象）
  - 必須: 影響/レビュー観点（テストカバレッジ確認）
  - 必須: 想定リスク（テスト漏れ）
- `config-risk`
  - 用途: 設定変更で影響大
  - 必須: 理由（変更内容）
  - 必須: 影響/レビュー観点（影響範囲の特定）
  - 必須: 想定リスク（設定ミスによる障害）
- `refactor-scope`
  - 用途: リファクタで広範囲
  - 必須: 理由（リファクタ目的）
  - 必須: 影響/レビュー観点（既存動作の維持確認）
  - 必須: 想定リスク（予期しない動作変更）

### 例外ラベルの記入例

```markdown
## 例外ラベル: `bulk-format`

理由: Prettierによる全ファイル整形（設定変更に伴う）
影響/レビュー観点: 機能変更がないことを確認。空白・改行のみの変更
想定リスク: 意図しないコード変更が混入する可能性
```

---

## 依存関係の表現

### 必須記載事項

1. **Blocked by**: 依存するIssue番号と理由
2. **先に終わると何が可能になるか**: 1行で説明

### 記載例

```markdown
## 依存関係

- Blocked by: #12（DBスキーマが必要なため）
- 先に終わると何が可能になるか: APIエンドポイントの実装が開始可能
```

### ラベル

- `blocked`: 他のIssueの完了を待っている
- `parallel-ok`: 他のIssueと並行して作業可能

---

## Issue本文テンプレート

```markdown
## 概要

[何をするかを1-2文で]

## 背景

- Epic: [Epicファイルへのリンク]
- PRD: [PRDファイルへのリンク]

## 受け入れ条件（AC）

- [ ] AC1: [観測可能な条件]
- [ ] AC2: [観測可能な条件]

## 技術メモ

- 変更対象ファイル: [ファイル一覧]
- 推定行数: [50-100行]

## 依存関係

- Blocked by: #[Issue番号]（[理由]）
- 先に終わると何が可能になるか: [説明]

## ラベル

- `parallel-ok` / `blocked`
```

---

## 初回サイクルの運用

初回サイクルでは例外ラベルを**使わない**ことを推奨。

理由：
- 規約の感覚を掴むため
- 必要になったら使う

---

## 関連ファイル

- `.agent/commands/create-issues.md` - Issue作成コマンド
- `.agent/rules/epic.md` - Epic生成ルール
- `.agent/rules/dod.md` - Definition of Done
