# /review

PRやIssueのレビューを実行するコマンド。

## 使用方法

```
/review [PR番号 または Issue番号]
```

省略時は現在のブランチに関連するPRをレビュー。

## 実行フロー

### Phase 1: 対象の特定

1. PR番号またはIssue番号を特定
2. 関連するPRD、Epicを特定
3. 変更ファイル一覧を取得

### Phase 2: /sync-docs の実行

**必須**: レビュー前に `/sync-docs` を実行

```markdown
## 同期結果

### 差分の種類
- [ ] 仕様変更
- [ ] 解釈変更
- [ ] 実装都合

### 推奨アクション
- [ ] PRD更新が必要
- [ ] Epic更新が必要
- [ ] 実装修正が必要
- [ ] 差分なし（同期済み）

### 参照（必須）
- PRD: [ファイル名] セクション [番号/名前]
- Epic: [ファイル名] セクション [番号/名前]
- 該当コード: [ファイル:行]
```

### Phase 3: DoD チェック

#### Issue完了の条件

```
□ すべてのACが満たされている
□ テストが追加/更新されている（該当する場合）
□ /sync-docs で「差分なし」または差分が承認済み
□ コードレビューが完了している
□ CIが通っている（該当する場合）
```

#### PR完了の条件

| 項目 | 確認内容 |
|-----|---------|
| AC達成 | Issue記載のすべてのACを満たすか |
| sync-docs実行 | 差分なし or 差分承認済みか |
| テスト | 新規/変更コードにテストがあるか |
| レビュー | 最低1名のApproveがあるか |

### Phase 4: ACの検証

Issue記載のACを1つずつ検証：

```markdown
## AC検証結果

### AC1: [AC内容]
- 状態: 達成 / 未達成 / 部分的
- 確認方法: [どう確認したか]
- 証跡: [スクリーンショット / ログ / テスト結果]

### AC2: [AC内容]
- 状態: 達成 / 未達成 / 部分的
- 確認方法: [どう確認したか]
- 証跡: [スクリーンショット / ログ / テスト結果]
```

### Phase 5: コードレビュー観点

| 観点 | チェック内容 |
|-----|------------|
| 正確性 | ACを満たしているか |
| 可読性 | コードが理解しやすいか |
| テスト | テストが十分か |
| セキュリティ | 脆弱性がないか |
| パフォーマンス | 問題がないか |

### Phase 6: 見積もりとの比較

実装結果と見積もりを比較：

```markdown
## 見積もり比較

| 項目 | 見積もり | 実績 | 差異 |
|-----|---------|------|------|
| 行数 | [50-100行] | [75行] | 範囲内 |
| ファイル数 | [3] | [3] | 一致 |
| 工数 | [2-4h] | [3h] | 範囲内 |

### 差異の理由（大きい場合）
[差異が大きい場合は理由を記載]
```

### Phase 7: レビュー結果の出力

```markdown
## レビュー結果

### 総合判定
Approve / Request Changes / Comment

### sync-docs結果
差分なし / 差分あり（承認済み） / 差分あり（要対応）

### DoD達成状況
- [x] すべてのACが満たされている
- [x] テストが追加/更新されている
- [x] /sync-docs で差分なし
- [ ] コードレビューが完了している ← 本レビューで完了予定
- [x] CIが通っている

### AC検証結果
- AC1: 達成
- AC2: 達成
- AC3: 達成

### 指摘事項
1. [指摘内容]（重要度: 高/中/低）
2. [指摘内容]（重要度: 高/中/低）

### コメント
[総評やアドバイス]
```

## sync-docs結果の扱い

| 結果 | 対応 |
|------|------|
| 差分なし | PRマージ可能 |
| 差分あり（軽微） | 差分を記録してマージ |
| 差分あり（重大） | PRD/Epic更新後にマージ |

## オプション

| オプション | 説明 |
|-----------|------|
| `--quick` | sync-docsとAC検証のみ（コード詳細レビューなし） |
| `--full` | すべての観点でフルレビュー |
| `--ac-only` | AC検証のみ |

## 関連ルール

- `.agent/rules/dod.md` - Definition of Done
- `.agent/rules/docs-sync.md` - ドキュメント同期ルール
- `.agent/commands/sync-docs.md` - 同期コマンド

## 次のステップ

レビュー完了後：
- Approve → マージ可能
- Request Changes → 修正後、再度 `/review`
