# 意思決定記録（ADR）

プロジェクトの技術的・設計的意思決定を記録するドキュメント。

---

## テンプレート

```markdown
## ADR-[番号]: [タイトル]

### ステータス

提案 / 承認 / 却下 / 廃止

### 日付

YYYY-MM-DD

### コンテキスト

[なぜこの決定が必要になったか]

### 選択肢

#### 案A: [名前]

- 説明: [説明]
- メリット: [メリット]
- デメリット: [デメリット]

#### 案B: [名前]

- 説明: [説明]
- メリット: [メリット]
- デメリット: [デメリット]

### 決定

[どの案を採用したか]

### 理由

[なぜその案を選んだか]

### 影響

[この決定による影響]

### 参照

- PRD: [関連PRD]
- Epic: [関連Epic]
- Issue: [関連Issue]
```

---

## 意思決定一覧

ADR-1
タイトル: [例: データベース選定]
ステータス: [承認]
日付: [YYYY-MM-DD]

ADR-2
タイトル: Ruff S ルール段階導入と例外運用
ステータス: 承認
日付: 2026-02-18

---

## ADR-1: [例: データベース選定]

### ステータス

承認

### 日付

YYYY-MM-DD

### コンテキスト

[プロジェクトでデータ永続化が必要。RDBかNoSQLかを決定する必要がある]

### 選択肢

#### 案A: PostgreSQL

- 説明: オープンソースのRDB
- メリット: ACID準拠、豊富なエコシステム、JSON対応
- デメリット: スケールアウトが難しい

#### 案B: MongoDB

- 説明: ドキュメント指向NoSQL
- メリット: スキーマレス、スケールアウト容易
- デメリット: 複雑なクエリが苦手、トランザクション制限

### 決定

案A: PostgreSQL を採用

### 理由

- PRDの要件はリレーショナルデータが中心
- トランザクションが必要な処理がある
- 技術方針「シンプル優先」に合致

### 影響

- マイグレーションツールの選定が必要
- ORM/クエリビルダーの選定が必要

### 参照

- PRD: docs/prd/example.md セクション6
- Epic: docs/epics/example-epic.md セクション3.2

---

## ADR-2: Ruff S ルール段階導入と例外運用

### ステータス

承認

### 日付

2026-02-18

### コンテキスト

Issue #86 で `ruff check . --select S` を段階導入するにあたり、既存スクリプトの `subprocess` 実行と例外処理に起因する違反（S112/S603/S607）が検出された。

### 選択肢

#### 案A: すべてコード置換で解消し、noqaを禁止

- 説明: 例外なしでS違反をゼロにする
- メリット: ルールが単純で監査しやすい
- デメリット: 実行コマンドが固定で安全な箇所まで大きく改修が必要

#### 案B: 最小修正 + 明示的な例外注釈

- 説明: S112/S110はコード修正、`subprocess` は安全性を担保した上で最小限 `# noqa: S603` を付与
- メリット: 既存動作を維持しつつ段階導入できる
- デメリット: 例外管理を継続運用する必要がある

### 決定

案Bを採用する。

### 理由

- 既存スクリプトは `shell=False` かつ固定コマンドの実行が中心で、実害リスクを抑えながら導入できる
- 過剰なリファクタを避け、Issueスコープ内で最小変更を維持できる

### 影響

- 新規/変更で `# noqa: S603` を追加する場合は、該当行に限定し、実行引数が固定であることを前提にする
- `S112/S110` は握りつぶしを避け、具体例外の捕捉または分岐で解消する
- CI/ローカルで `ruff check . --select S` を継続実行する

### 参照

- Issue: #86
- 調査: docs/research/estimation/issue-86/2026-02-18.md
