# AGENTS.md

このリポジトリでAIエージェントが従うべきルール。

---

## プロジェクト概要

Agentic-SDD（Agentic Spec-Driven Development）

非エンジニアがLLM暴走を防ぎつつ、AI駆動開発を進めるためのワークフローテンプレート。

---

## 重要ファイル

- `.agent/commands/`: コマンド定義（create-prd, create-epic 等）
- `.agent/rules/`: ルール定義（docs-sync, dod, epic, issue 等）
- `docs/prd/_template.md`: PRDテンプレート
- `docs/epics/_template.md`: Epicテンプレート
- `docs/glossary.md`: 用語集
- `DESIGN.md`: 設計書（正本）

---

## コマンド一覧

- `/create-prd`: PRD作成（7問質問形式）
- `/create-epic`: Epic作成（必須提出物: 外部サービス一覧/コンポーネント一覧/新規技術一覧）
- `/create-issues`: Issue作成（粒度規約適用）
- `/impl`: 実装（Full見積もり必須）
- `/tdd`: TDDで実装（Red→Green→Refactor）
- `/review`: レビュー（DoD確認）
- `/sync-docs`: ドキュメント同期チェック

---

## 必須ルール

### 1. PRD作成時

- 7問の質問形式で作成
- Q6（技術的制約）は選択式
- 禁止語辞書をチェック
- 異常系ACを最低1つ含む
- Unknownが2つ以上ならPRD未完成

### 2. Epic作成時

- 必須提出物（外部サービス一覧/コンポーネント一覧/新規技術一覧）を必ず含む
- 技術方針別の制限を適用
- 代替案を必ず提示
- 「将来のため」だけの複雑化は禁止

### 3. Issue作成時

- 粒度規約: 50〜300行、1〜5ファイル、2〜5 AC
- 例外ラベル使用時は必須記入欄を埋める
- 依存関係を明記

### 4. 見積もり時

- Full（11セクション）必須
- 該当なしは「N/A（理由）」と明記
- 信頼度（High/Med/Low）を付与

### 5. レビュー時

- `/sync-docs` を実行
- 差分があれば参照（PRD/Epic/コード）を明記
- DoDチェックリストを確認

---

## 禁止事項

- 禁止語の使用（適切に、なるべく、高速など）
- 必須提出物なしでのEpic作成
- 粒度規約無視のIssue作成
- Lite見積もり（Full必須）
- 参照なしでの差分報告
- 上位ドキュメント（PRD）の無断変更

---

## カウント定義

- 外部サービス数: SaaS、マネージドDB、認証基盤、外部API を各1
- コンポーネント数: 別プロセス、別ジョブ、別ワーカー、別バッチ を各1
- 新規技術: DB、キュー、認証、観測基盤、フレームワーク、クラウドサービス を各1

---

## 技術方針別制限

### シンプル優先

- 外部サービス: 最大1
- 新規ライブラリ: 最大3
- 新規コンポーネント: 最大3
- 非同期基盤: 禁止
- マイクロサービス: 禁止
- K8s等: 禁止

### バランス

- 外部サービス: 最大3
- 新規ライブラリ: 最大5
- 新規コンポーネント: 最大5
- 非同期基盤: 要理由
- マイクロサービス: 要理由

---

## ドキュメント正本の階層

優先順位: PRD（要件） > Epic（実装計画） > 実装（コード）

矛盾がある場合は上位に従う。

---

## 参照

- 設計書: `DESIGN.md`
- 用語集: `docs/glossary.md`
- 意思決定: `docs/decisions.md`
