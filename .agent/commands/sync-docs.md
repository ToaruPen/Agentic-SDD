# /sync-docs

PRD、Epic、実装コード間の整合性をチェックするコマンド。

## 使用方法

```
/sync-docs [PRDファイル名]
```

省略時は現在のブランチに関連するPRDを自動検出。

## 実行フロー

### Phase 1: ファイル収集

1. PRDファイルを特定（`docs/prd/*.md`）
2. 関連するEpicファイルを特定（`docs/epics/*.md`）
3. 実装コードの変更を収集（git diff または指定範囲）

### Phase 2: 差分検出

以下の観点で差分をチェック：

| チェック項目 | PRD参照箇所 | 比較対象 |
|-------------|------------|---------|
| 機能要件 | セクション4 | Epic技術設計 / コード |
| AC | セクション5 | テストコード / 実装 |
| スコープ外 | Q5 | 実装範囲 |
| 技術制約 | Q6 | Epic技術選定 |

### Phase 3: 差分分類

検出した差分を以下に分類：

| 種類 | 説明 | 対応 |
|-----|------|------|
| 仕様変更 | PRDの要求自体が変わる | PRD更新が必要 |
| 解釈変更 | PRDの解釈が変わる | Epic更新が必要 |
| 実装都合 | 技術的制約による変更 | 理由を記録 |

### Phase 4: レポート出力

```markdown
## 同期結果

### 差分の種類
- [ ] 仕様変更（PRDの要求自体が変わる）
- [ ] 解釈変更（PRDの解釈が変わる）
- [ ] 実装都合（技術的制約による変更）

### 推奨アクション
- [ ] PRD更新が必要
- [ ] Epic更新が必要
- [ ] 実装修正が必要
- [ ] 差分なし（同期済み）

### 影響範囲
- [ ] テストへの影響
- [ ] 運用への影響
- [ ] ユーザーへの影響

### 参照（必須）
- PRD: [ファイル名] セクション [番号/名前]
- Epic: [ファイル名] セクション [番号/名前]
- 該当コード: [ファイル:行]

### 詳細
[差分の具体的な内容]
```

## 出力例

### 差分なしの場合

```markdown
## 同期結果

### 差分の種類
（なし）

### 推奨アクション
- [x] 差分なし（同期済み）

### 参照
- PRD: docs/prd/my-project.md
- Epic: docs/epics/my-project-epic.md

### 詳細
PRD、Epic、実装コードは同期されています。
```

### 差分ありの場合

```markdown
## 同期結果

### 差分の種類
- [x] 解釈変更（PRDの解釈が変わる）

### 推奨アクション
- [x] Epic更新が必要

### 影響範囲
- [x] テストへの影響

### 参照（必須）
- PRD: docs/prd/my-project.md セクション 5. AC
- Epic: docs/epics/my-project-epic.md セクション 3.2 API設計
- 該当コード: src/api/handlers.ts:42-58

### 詳細
PRDでは「ユーザー一覧をページネーションで取得」と記載されているが、
実装では無限スクロール方式になっている。

**推奨対応:**
1. Epicの「3.2 API設計」セクションを更新し、無限スクロール方式を明記
2. PRDのACを更新するか、現状維持するか確認
```

## 実行タイミング

| タイミング | 実行 | 理由 |
|-----------|------|------|
| PR作成時 | **必須（DoD）** | 乖離を検出 |
| マージ後 | 推奨 | 確認用 |
| 実装中の大きな変更時 | 推奨 | 早期発見 |

## オプション

| オプション | 説明 |
|-----------|------|
| `--verbose` | 詳細な差分情報を表示 |
| `--fix` | 自動修正可能な差分を修正（確認付き） |
| `--epic [ファイル名]` | 特定のEpicのみチェック |

## 関連ルール

- `.agent/rules/docs-sync.md` - ドキュメント同期ルール
- `.agent/rules/dod.md` - Definition of Done

## 注意事項

- 参照（PRD/Epic/コード）は**必須**。省略禁止。
- 差分を暗黙的に無視しない。
- 上位ドキュメント（PRD）を勝手に変更しない。
